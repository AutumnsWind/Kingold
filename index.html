<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Slim框架 by AutumnsWind</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Slim框架</h1>
      <h2 class="project-tagline">适合用来快速写一些对性能要求不高的程序。</h2>
      <a href="https://github.com/AutumnsWind/Kingold" class="btn">View on GitHub</a>
      <a href="https://github.com/AutumnsWind/Kingold/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/AutumnsWind/Kingold/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="leiphp-微型的php框架" class="anchor" href="#leiphp-%E5%BE%AE%E5%9E%8B%E7%9A%84php%E6%A1%86%E6%9E%B6" aria-hidden="true"><span class="octicon octicon-link"></span></a>LeiPHP 微型的PHP框架</h1>

<p>此框架仅有一个文件，其中包含了MySQL数据库、上传文件、调试信息、导入依赖文件、
模板和REST路由等一系列常用操作。适合用来快速写一些对性能要求不高的程序。</p>

<h1>
<a id="初始化" class="anchor" href="#%E5%88%9D%E5%A7%8B%E5%8C%96" aria-hidden="true"><span class="octicon octicon-link"></span></a>初始化</h1>

<p>首先新建一个<code>config.inc.php</code>文件，所有程序通过加载该文件来进行配置及初始化：</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * 配置文件</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// 当前应用的根目录</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>APP_ROOT<span class="pl-pds">'</span></span>, <span class="pl-c1">dirname</span>(<span class="pl-c1">__FILE__</span> )<span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c">// 模板根目录</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>APP_TEMPLATE_ROOT<span class="pl-pds">'</span></span>, <span class="pl-c1">APP_ROOT</span><span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span>template/<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// 输出调试信息，生成环境请去掉这行或设置为false</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>APP_DEBUG<span class="pl-pds">'</span></span>, <span class="pl-c1">true</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// MYSQL数据库配置，如果不定义数据库配置，则不自动连接数据库</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>CONF_MYSQL_SERVER<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>localhost:3306<span class="pl-pds">'</span></span>);  <span class="pl-c">// 服务器，默认为 localhost:3306</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>CONF_MYSQL_USER<span class="pl-pds">'</span></span>,   <span class="pl-s"><span class="pl-pds">'</span>root<span class="pl-pds">'</span></span>);            <span class="pl-c">// 用户名，默认为 root</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>CONF_MYSQL_PASSWD<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>123456<span class="pl-pds">'</span></span>);          <span class="pl-c">// 密码，默认为空</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>CONF_MYSQL_DBNAME<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>test<span class="pl-pds">'</span></span>);            <span class="pl-c">// 数据库名，默认为空</span></span>
<span class="pl-s1"><span class="pl-c1">define</span>(<span class="pl-s"><span class="pl-pds">'</span>CONF_MYSQL_PERMANENT<span class="pl-pds">'</span></span>, <span class="pl-c1">false</span>);          <span class="pl-c">// 使用使用永久连接，默认false</span></span>
<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// 载入leiphp并初始化</span></span>
<span class="pl-s1"><span class="pl-k">require</span>(<span class="pl-c1">APP_ROOT</span><span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span>leiphp.php<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">APP</span><span class="pl-k">::</span>init();</span>
<span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<p>在所有php程序中，均可载入<code>config.inc.php</code>文件唉实现初始化leiphp：</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">require</span>(<span class="pl-s"><span class="pl-pds">'</span>config.inc.php<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c">// ...</span></span>
<span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<h1>
<a id="rest路由" class="anchor" href="#rest%E8%B7%AF%E7%94%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>REST路由</h1>

<p>leiphp可以根据不同的请求方法来调用相应的处理函数完成请求，比如：</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">require</span>(<span class="pl-s"><span class="pl-pds">'</span>config.inc.php<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// 这里是公共部分的代码，所有请求方法都会执行下面的代码</span></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>所有请求方法都会执行这里的代码<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// 定义处理GET请求的代码</span></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">method_get</span> () {</span>
<span class="pl-s1">  <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>GET请求方法的处理代码<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// 定义处理POST请求的代码</span></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">method_post</span> () {</span>
<span class="pl-s1">  <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>POST请求方法的处理代码<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// 定义处理DELETE请求的代码</span></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">method_delete</span> () {</span>
<span class="pl-s1">  <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-s1"><span class="pl-k">DELETE</span>请求方法的处理代码</span><span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// 定义处理PUT请求的代码</span></span>
<span class="pl-s1"><span class="pl-k">function</span> <span class="pl-en">method_put</span> () {</span>
<span class="pl-s1">  <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>PUT请求方法的处理代码<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<h1>
<a id="操作mysql数据库" class="anchor" href="#%E6%93%8D%E4%BD%9Cmysql%E6%95%B0%E6%8D%AE%E5%BA%93" aria-hidden="true"><span class="octicon octicon-link"></span></a>操作MySQL数据库</h1>

<p>leiphp中提供了一个静态类 <strong>SQL</strong> 来操作MySQL数据库：</p>

<ul>
<li><p><code>SQL::connect($server = 'localhost:3306', $username = 'root', $password = '',$database = '');</code>
连接到数据库，当配置了数据库连接时，leiapp会自动执行此方法来连接到数据库，若你的
程序中已经通过<code>mysql_connect</code>来创建了一个数据库连接，可以不用再执行此方法连接数
据库；</p></li>
<li><p><code>SQL::getAll($sql)</code> 或 <code>SQL::getData($sql)</code> 查询SQL，并返回数组格式的结果，
失败返回<code>FALSE</code>；</p></li>
<li><p><code>SQL::getOne($sql)</code> 或 <code>SQL::getLine($sql)</code> 查询SQL，仅返回第一条结果，
失败返回<code>FALSE</code>；</p></li>
<li><p><code>SQL::update($sql)</code> 或 <code>SQL::runSql($sql)</code> 查询SQL，返回受影响的记录数，一般
用于执行插入或更新操作；</p></li>
<li><p><code>SQL::id()</code> 或 <code>SQL::lastId()</code> 返回最后插入的一条记录的ID；</p></li>
<li><p><code>SQL::errno()</code> 返回最后执行的一条SQL语句的出错号</p></li>
<li><p><code>SQL::errmsg()</code> 返回最后执行的一条SQL语句的出错信息</p></li>
<li><p><code>SQL::escape($str)</code> 返回安全的SQL字符串</p></li>
</ul>

<p>更简便的数据库操作：</p>

<ul>
<li><p><code>SQL::getAll($table, $where)</code> 查询所有记录，其中$table是表名，$where是一个条件
数组，如：array('id' =&gt; 1)</p></li>
<li><p><code>SQL::getOne($table, $where)</code> 查询一条记录</p></li>
<li><p><code>SQL::update($table, $where, $update)</code> 更新记录并返回受影响的记录数，其中
$update是要更新的数据数组，如：array('name' =&gt; 'haha')</p></li>
<li><p><code>SQL::insert($table, $data)</code> 插入一条记录并返回其ID，其中$data是一个数组，
如：array('name' =&gt; 'haha', 'age' =&gt; 20)</p></li>
<li><p><code>SQL::delete($table, $where)</code> 删除记录</p></li>
</ul>

<p>条件格式：</p>

<ul>
<li><p>普通：<code>array('a' =&gt; 1, 'b' =&gt; 2)</code> 相当于 <code>a=1 AND b=2</code></p></li>
<li><p>指定连接操作符：<code>array('link' =&gt; 'OR', 'a' =&gt; 1, 'b' =&gt; 2)</code> 相当于 <code>a=1 OR b=2</code></p></li>
<li><p>指定比较操作符：<code>array('a' =&gt; array('&gt;' =&gt; 2))</code> 相当于 <code>a&gt;2</code></p></li>
<li><p>同一个字段多个条件：<code>array('a' =&gt; array('&gt;' =&gt; 2, '&lt;' =&gt; 5))</code> 相当于
<code>(a&gt;2 AND a &lt; 5)</code></p></li>
<li><p>指定多个条件的连接操作符：<code>array('a' =&gt; array('link' =&gt; 'OR', '&gt;' =&gt; 2, '&lt;' =&gt; 5))</code> 
相当于 <code>(a&gt;2 OR a &lt; 5)</code></p></li>
</ul>

<h1>
<a id="上传文件操作" class="anchor" href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>上传文件操作</h1>

<p>leiphp中提供了一个静态类 <strong>UPLOAD</strong> 来操作上传文件：</p>

<ul>
<li><p><code>UPLOAD::get($filename)</code> 返回指定名称的上传文件信息，该名称为<code>&lt;form&gt;</code>表单中的
<code>&lt;input type="file"&gt;</code>中的<strong>name</strong>值，该返回值为一个数组，包含以下项： <strong>name</strong> 
（名称）， <strong>type</strong> （MIME类型）， <strong>size</strong> （大小）， 
<strong>tmp_name</strong> （临时文件名）；</p></li>
<li><p><code>UPLOAD::move($file, $target)</code> 移动上传的文件到指定位置，第一个参数为
<code>UPLOAD::get($filename)</code>的返回值，第二个参数为目标文件名；</p></li>
</ul>

<h1>
<a id="调试信息操作" class="anchor" href="#%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF%E6%93%8D%E4%BD%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>调试信息操作</h1>

<p>leiphp中提供了一个静态类 <strong>DEBUG</strong> 来操作调试信息，当定义了常量<code>APP_DEBUG</code>时，
会在页面底部输出调试信息：</p>

<ul>
<li><p><code>DEBUG::put($msg = '', $title = '')</code> 输出调试信息</p></li>
<li><p><code>DEBUG::get()</code> 取调试信息</p></li>
<li><p><code>DEBUG::clear()</code> 清除所有调试信息</p></li>
</ul>

<h1>
<a id="应用相关操作" class="anchor" href="#%E5%BA%94%E7%94%A8%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>应用相关操作</h1>

<p>leiphp中提供了一个静态类 <strong>APP</strong> 来进行应用相关的操作，及一些公共函数：</p>

<ul>
<li><p><code>APP::encryptPassword ($password)</code> 加密密码，返回一个加盐处理后的MD5字符串，
如：<code>FF:15855D447208A6AB4BD2CC88D4B91732:83</code>；</p></li>
<li><p><code>APP::validatePassword ($password, $encrypted)</code> 验证密码，第一个参数为待验证的
密码，第二个参数为<code>APP::encryptPassword ($password)</code>返回的字符串，
返回<code>TRUE</code>或<code>FALSE</code>；</p></li>
<li><p><code>APP::dump($var)</code> 打印变量结构，一般用于调试；</p></li>
<li><p><code>APP::showError($msg)</code> 显示出错信息</p></li>
<li><p><code>APP::load($filename)</code> 载入依赖的php文件，若不指定后缀名，会自动加上<code>.php</code>，
默认以当前php文件为根目录，若文件名以<code>/</code>开头，则以常量<code>APP_ROOT</code>定义的应用目录
作为根目录；</p></li>
<li><p><code>APP::sendJSON($data)</code> 返回JSON格式数据</p></li>
<li><p><code>APP::sendError($msg, $data = array())</code> 返回JSON格式的出错信息：<code>{"error":"msg"}</code></p></li>
<li><p><code>APP::authEncode($string, $key, $expirey)</code> 加密账户验证信息，可指定过期时间</p></li>
<li><p><code>APP::authDecode($string, $key)</code> 加密账户验证信息</p></li>
<li><p><code>APP::getTemplate($name, $locals)</code> 载入模板文件，若不指定后缀名，会
自动加上<code>.html</code>，以常量<code>APP_TEMPLATE_ROOT</code>定义的模板目录作为根目录，模板文件实际
上为php程序文件，第二个参数为模板中可用的变量，在模板中通过<code>$locals</code>来读取（若
无命名冲突也可以直接使用键名），返回渲染后的内容</p></li>
<li><p><code>APP::setLocals($name, $value)</code> 设置模板变量</p></li>
<li><p><code>APP::getLocals($name)</code> 取模板变量值</p></li>
<li><p><code>APP::render($name, $locals, $layout = '')</code> 自动为<code>$locals</code>加上用
<code>APP::setLocals()</code>设置的变量，并渲染模板。如果指定了视图模板<code>$layout</code>，则需要在
视图模板中通过<code>$body</code>变量来获取模板内容。</p></li>
<li><p><code>APP::init()</code> 初始化leiphp；</p></li>
<li><p><code>APP::end()</code> 提前退出</p></li>
</ul>

<h1>
<a id="自动路由" class="anchor" href="#%E8%87%AA%E5%8A%A8%E8%B7%AF%E7%94%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>自动路由</h1>

<p>leiphp中提供了一个静态类 <strong>ROUTER</strong> 来进行路由相关的操作：</p>

<ul>
<li><p><code>ROUTER::register($path, $function, $is_preg = false)</code> 注册中间件，其中<code>$path</code>
为路径前缀，<code>$function</code>为要执行的函数，如果<code>$is_preg</code>为<code>true</code>表示<code>$path</code>是一个
正则表达式</p></li>
<li><p><code>ROUTER::run($dir, $path)</code> 执行自动路由。其中<code>$dir</code>是要自动加载的PHP文件所在
的目录，以应用目录<code>APP_ROOT</code>中定义的目录为根目录，默认为<code>action</code>目录，<code>$path</code>是
当前请求的路径，默认为<code>$_GET['__path__']</code></p></li>
</ul>

<p>示例：</p>

<p>应用统一入口文件：index.php</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">require</span>(<span class="pl-s"><span class="pl-pds">'</span>config.inc.php<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-c1">ROUTER</span><span class="pl-k">::</span>run(<span class="pl-s"><span class="pl-pds">'</span>action<span class="pl-pds">'</span></span>, <span class="pl-k">@</span><span class="pl-smi">$_GET</span>[<span class="pl-s"><span class="pl-pds">'</span>__path__<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></pre></div>

<p>需要配置服务器的URL Rewrite，比如将 <code>/app/(.*)</code> 的所有请求转到
<code>/app/index.php?__path__=$1</code></p>

<p>Apache的配置示例：</p>

<pre><code>RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^app/(.*)$ /app/index.php?%{QUERY_STRING}&amp;__path__=$1 [L]
</code></pre>

<p>Nginx的配置示例：</p>

<div class="highlight highlight-source-lua"><pre><span class="pl-k">if</span> (!<span class="pl-k">-</span>e $request_filename) {
  <span class="pl-c1">rewrite</span> <span class="pl-s"><span class="pl-pds">"</span>^/app/(.*)<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>/app/index.php?%{QUERY_STRING}&amp;__path__=$1<span class="pl-pds">"</span></span> last;
}</pre></div>

<p>SAE的配置示例：</p>

<div class="highlight highlight-source-yaml"><pre><span class="pl-s"><span class="pl-ent">handle:</span></span>
 <span class="pl-s">- <span class="pl-ent">rewrite:</span> <span class="pl-s">if(!is_dir() &amp;&amp; !is_file() &amp;&amp; path~"^app/(.*)") goto "app/index.php?%{QUERY_STRING}&amp;__path__=$1"</span></span></pre></div>

<p>当请求 <code>/app/my/action</code> 时，会自动执行文件 <code>/action/my/action.php</code></p>

<p>如请求 <code>/app/my/action/</code> ，则自动执行文件 <code>/action/my/action/index.php</code></p>

<h1>
<a id="授权" class="anchor" href="#%E6%8E%88%E6%9D%83" aria-hidden="true"><span class="octicon octicon-link"></span></a>授权</h1>

<p>基于MIT协议发布。</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/AutumnsWind/Kingold">Slim框架</a> is maintained by <a href="https://github.com/AutumnsWind">AutumnsWind</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
